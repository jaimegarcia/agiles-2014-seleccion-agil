"use strict";function prepcloud(a){console.log("size "+wcont+","+hcont),d3.layout.cloud().size([wcont,hcont]).words(a.map(function(a){var b=size1;return 0!=a.cantidad&&(b=wcont/50+5*a.cantidad),{text:a.sector,size:b,cantidad:a.cantidad}})).padding(6).rotate(0).font("Impact").fontSize(function(a){return a.size}).on("end",draw).start();var b=wordcloud.append("filter").attr("id","dropshadow");b.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",3).attr("result","blur"),b.append("feOffset").attr("in","blur").attr("dx",3).attr("dy",4).attr("result","offsetBlur");var c=b.append("feMerge");c.append("feMergeNode").attr('in", "offsetBlur'),c.append("feMergeNode").attr("in","SourceGraphic")}function draw(a){sectorescargados=a,a.length!=globalsectores.length&&200>contador1?(contador1++,wcont+=1,prepcloud(globalsectores)):(console.log("contador: "+contador1),contador1=0,wordcloud.append("g").attr("transform","translate("+(wcont/2-wcont/20)+","+hcont/2+")").selectAll("text").data(a).enter().append("text").style("font-size",function(a){return a.size+"px"}).style("font-weight",function(a){return a.size==size1?"normal":"bold"}).style("font-family","arial").style("cursor",function(a){return a.size==size1?"default":"pointer"}).style("fill",function(a,b){return fill(b)}).attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")"}).text(function(a){return a.text}).on("mouseover",function(a){d3.select(this).style("opacity","0.6"),d3.select(this).transition().duration(100).delay(0).attr("transform","translate("+[a.x-0,a.y-0]+") scale(1.1)")}).on("mouseout",function(a){seleccionada!=this&&(d3.select(this).style("opacity","1"),d3.select(this).transition().duration(100).delay(0).attr("transform","translate("+[a.x+0,a.y+0]+") scale(1)"))}).on("click",function(a){a.size!=size1&&(d3.select(seleccionada).transition().duration(100).delay(0).attr("transform","translate("+[xant+0,yant+0]+") scale(1)"),d3.select(seleccionada).attr("filter",null),d3.select(this).attr("filter","url(#dropshadow)"),seleccionada=this,xant=a.x,yant=a.y,clicksector(a,globalsectores))}))}function resizeimages(){if(console.log("resize"+selected),wcontstr=d3.select(".containerWordCloud").style("width"),wcont=parseInt(wcontstr.substring(0,wcontstr.length-2))-50,wimg=d3.select(selected).style("width"),console.log("wimg: "+wimg+", wcont: "+wcont),wimg=parseInt(wimg.substring(0,wimg.length-2)),himg=d3.select(selected).style("height"),himg=parseInt(himg.substring(0,himg.length-2)),console.log("wimg "+wimg),himg>500&&(d3.select(selected).transition().duration(0).delay(0).style("height","500px").style("width","auto"),console.log("if de alto"),wimg=d3.select(selected).style("width"),wimg=parseInt(wimg.substring(0,wimg.length-2))),wimg>450){d3.select(selected).transition().duration(0).delay(0).style("width","450px").style("height","auto"),console.log("if de ancho"),himg=d3.select(selected).style("height"),himg=parseInt(himg.substring(0,himg.length-2))}}function clicksector(a,b){selected="#"+a.text,selected=selected.replace(" ","_"),selected=selected.replace("-","_"),console.log("click "+selected),$(selected).attr({style:"width:110%"}),$(selected).attr({style:"height:500px"});for(var c=0;c<b.length;c++){var d="#"+b[c].sector;d=d.replace(" ","_"),d=d.replace("-","_"),selected!=d&&(console.log("sector "+d),d3.selectAll(d).transition().duration(1e3).delay(0).style("display","none"),d3.select(this).attr("filter",null)),c==b.length-1&&d3.select(selected).transition().duration(1e3).delay(0).style("display","block")}resizeimages()}var d3CategoryAB=["#00ADB5","#FF636E","#71B862","#8000C1","#FFE263","#655A98","#FF7600","#78FF63"];d3.scale.categoryAB=function(){return d3.scale.ordinal().range(d3CategoryAB)};var fill=d3.scale.ordinal().range(d3CategoryAB),wcontstr=d3.select(".containerWordCloud").style("width"),wcont=parseInt(wcontstr.substring(0,wcontstr.length-2))-0,wcontant=wcont,wimg,himg,hcont=350,wordcloud=d3.select("#word-cloud").append("svg").attr("width",wcont).attr("height",hcont),seleccionada,xant,yant,globalsectores,sectorescargados,size1=30,contador1=0,selected="#Lenguajes_ProgramaciÃ³n";d3.csv("data/software.csv",function(a){globalsectores=a,prepcloud(a)}),window.onload=function(){resizeimages()},window.onresize=function(){wcontstr=d3.select(".containerWordCloud").style("width"),wcont=parseInt(wcontstr.substring(0,wcontstr.length-2))-50,wcontant!=wcont&&(d3.select("#word-cloud").select("g").remove(),prepcloud(globalsectores),resizeimages()),wcontant=wcont};