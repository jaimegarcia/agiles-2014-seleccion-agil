d3.parcoords=function(e){function m(e,t,r){d3.keys(t).forEach(function(i){e[i]=function(s){if(!arguments.length)return t[i];var o=t[i];t[i]=s;v[i].call(n,{value:s,previous:o});r[i].call(n,{value:s,previous:o});return e}})}function g(e,t){for(key in t){e[key]=t[key]}return e}function b(e,n){n.strokeStyle=d3.functor(t.color)(e);n.beginPath();t.dimensions.map(function(t,r){if(r==0){n.moveTo(N(t),a[t](e[t]))}else{n.lineTo(N(t),a[t](e[t]))}});n.stroke()}function w(e,n){n.clearRect(-1,-1,i()+2,s()+2);n.beginPath();e.forEach(function(e){t.dimensions.map(function(t,r){if(r==0){n.moveTo(N(t),a[t](e[t]))}else{n.lineTo(N(t),a[t](e[t]))}})});n.stroke()}function E(e){return b(e,p.foreground)}function S(e){return b(e,p.highlight)}function x(e){return!a[e].brush.empty()}function T(){var e=t.dimensions.filter(x),n=e.map(function(e){return a[e].brush.extent()});var r={date:function(e,t,r){return n[r][0]<=e[t]&&e[t]<=n[r][1]},number:function(e,t,r){return n[r][0]<=e[t]&&e[t]<=n[r][1]},price:function(e,t,r){return n[r][0]<=e[t]&&e[t]<=n[r][1]},string:function(e,t,r){return n[r][0]<=a[t](e[t])&&a[t](e[t])<=n[r][1]},quality:function(e,t,r){return n[r][0]<=a[t](e[t])&&a[t](e[t])<=n[r][1]}};return t.data.filter(function(n){return e.every(function(e,i){return r[t.types[e]](n,e,i)})})}function N(e){var t=f[e];return t==null?u(e):t}var t={data:[],dimensions:[],dimensionTitles:{},types:{},brushed:false,mode:"default",rate:20,width:600,height:300,margin:{top:24,right:0,bottom:12,left:0},color:"#069",composite:"source-over",alpha:.7};g(t,e);var n=function(e){e=n.selection=d3.select(e);t.width=e[0][0].clientWidth;t.height=e[0][0].clientHeight;["shadows","marks","foreground","highlight"].forEach(function(t){d[t]=e.append("canvas").attr("class",t)[0][0];p[t]=d[t].getContext("2d")});n.svg=e.append("svg").attr("width",t.width).attr("height",t.height).append("svg:g").attr("transform","translate("+t.margin.left+","+t.margin.top+")");return n};var r=d3.dispatch.apply(this,["render","resize","highlight","brush"].concat(d3.keys(t))),i=function(){return t.width-t.margin.right-t.margin.left},s=function(){return t.height-t.margin.top-t.margin.bottom},o={brushable:false,reorderable:false,axes:false,interactive:false,shadows:false,debug:false},u=d3.scale.ordinal(),a={},f={},l=d3.svg.line(),c=d3.svg.axis().orient("left").ticks(5),h,p={},d={};window.onresize=function(){t.width=document.getElementsByClassName("parcoords")[0].offsetWidth;n.resize();n.brushReset()};var v=d3.dispatch.apply(this,d3.keys(t)).on("composite",function(e){p.foreground.globalCompositeOperation=e.value}).on("alpha",function(e){p.foreground.globalAlpha=e.value}).on("width",function(e){n.resize()}).on("height",function(e){n.resize()}).on("margin",function(e){n.resize()}).on("rate",function(e){y.rate(e.value)}).on("data",function(e){if(o.shadows)w(t.data,p.shadows)}).on("dimensions",function(e){u.domain(t.dimensions);if(o.interactive)n.render().updateAxes()});n.state=t;n.flags=o;m(n,t,r);d3.rebind(n,r,"on");d3.rebind(n,c,"ticks","orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat");n.autoscale=function(){var e={date:function(e){return d3.time.scale().domain(d3.extent(t.data,function(t){return t[e]?t[e].getTime():null})).range([s()+1,1])},number:function(e){return d3.scale.linear().domain(d3.extent(t.data,function(t){return+t[e]})).range([s()+1,1])},price:function(e){return d3.scale.linear().domain(d3.extent(t.data,function(t){return+t[e]})).range([1,s()+1])},string:function(e){return d3.scale.ordinal().domain(t.data.map(function(t){return t[e]})).rangePoints([s()+1,1])},quality:function(e){return d3.scale.ordinal().domain(["Bad","Poor","Fair","Good","Excellent"]).rangePoints([s()+1,1])}};t.dimensions.forEach(function(n){a[n]=e[t.types[n]](n)});n.dimensions(n.dimensions().filter(function(e,n){var r=a[e].domain().length;if(t.types[e]=="string"&&(r>60||r<2)){return false}return true}));u.rangePoints([0,i()],1);n.selection.selectAll("canvas").style("margin-top",t.margin.top+"px").style("margin-left",t.margin.left+"px").attr("width",i()+2).attr("height",s()+2);p.foreground.strokeStyle=t.color;p.foreground.lineWidth=4;p.foreground.globalCompositeOperation=t.composite;p.foreground.globalAlpha=t.alpha;p.highlight.lineWidth=3;p.shadows.strokeStyle="#dadada";return this};n.detectDimensions=function(){n.types(n.detectDimensionTypes(t.data));n.dimensions(d3.keys(n.types()));return this};n.toType=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};n.toTypeCoerceNumbers=function(e){if(parseFloat(e)==e&&e!=null)return"number";return n.toType(e)};n.detectDimensionTypes=function(e){var t={};d3.keys(e[0]).forEach(function(r){t[r]=n.toTypeCoerceNumbers(e[0][r])});return t};n.render=function(){if(!t.dimensions.length)n.detectDimensions();if(!(t.dimensions[0]in a))n.autoscale();n.render[t.mode]();r.render.call(this);return this};n.render.default=function(){n.clear("foreground");if(t.brushed){t.brushed.forEach(E)}else{t.data.forEach(E)}};var y=d3.renderQueue(E).rate(50).clear(function(){n.clear("foreground")});n.render.queue=function(){if(t.brushed){y(t.brushed)}else{y(t.data)}};n.shadows=function(){o.shadows=true;if(t.data.length>0)w(t.data,p.shadows);return this};n.axisDots=function(){var e=n.ctx.marks;e.globalAlpha=d3.min([1/Math.pow(data.length,1/2),1]);t.data.forEach(function(n){t.dimensions.map(function(t,r){e.fillRect(N(t)-.75,a[t](n[t])-.75,1.5,1.5)})});return this};n.clear=function(e){p[e].clearRect(0,0,i()+2,s()+2);return this};n.createAxes=function(){if(h)n.removeAxes();h=n.svg.selectAll(".dimension").data(t.dimensions,function(e){return e}).enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+u(e)+")"});h.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(c.scale(a[e]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-12)",x:0,"class":"label"}).text(function(e){return e in t.dimensionTitles?t.dimensionTitles[e]:e});o.axes=true;return this};n.removeAxes=function(){h.remove();return this};n.updateAxes=function(){var e=n.svg.selectAll(".dimension").data(t.dimensions,function(e){return e});e.enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+N(e)+")"}).style("opacity",0).append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(c.scale(a[e]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-12)",x:0,"class":"label"}).text(String);e.exit().remove();h=n.svg.selectAll(".dimension");h.transition().duration(1100).attr("transform",function(e){return"translate("+N(e)+")"}).style("opacity",1);if(o.shadows)w(t.data,p.shadows);return this};n.brushable=function(){if(!h)n.createAxes();h.append("svg:g").attr("class","brush").each(function(e){d3.select(this).call(a[e].brush=d3.svg.brush().y(a[e]).on("brushstart",function(){d3.event.sourceEvent.stopPropagation()}).on("brush",n.brush))}).selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30);o.brushable=true;return this};n.reorderable=function(){if(!h)n.createAxes();h.style("cursor","move").call(d3.behavior.drag().on("dragstart",function(e){f[e]=this.__origin__=u(e)}).on("drag",function(e){f[e]=Math.min(i(),Math.max(0,this.__origin__+=d3.event.dx));t.dimensions.sort(function(e,t){return N(e)-N(t)});u.domain(t.dimensions);n.render();h.attr("transform",function(e){return"translate("+N(e)+")"})}).on("dragend",function(e){delete this.__origin__;delete f[e];d3.select(this).transition().attr("transform","translate("+u(e)+")");n.render()}));o.reorderable=true;return this};n.adjacent_pairs=function(e){var t=[];for(var n=0;n<e.length-1;n++){t.push([e[n],e[n+1]])}return t};n.interactive=function(){o.interactive=true;return this};n.brush=function(){t.brushed=T();r.brush.call(n,t.brushed);n.render()};n.xscale=u;n.yscale=a;n.ctx=p;n.canvas=d;n.g=function(){return h};n.brushReset=function(e){if(h){h.selectAll(".brush").each(function(e){d3.select(this).call(a[e].brush.clear())});n.brush()}return this};n.resize=function(){n.selection.select("svg").attr("width",t.width).attr("height",t.height);n.svg.attr("transform","translate("+t.margin.left+","+t.margin.top+")");n.autoscale();if(h)n.createAxes().brushable();r.resize.call(this,{width:t.width,height:t.height,margin:t.margin});return this};n.highlight=function(e){n.clear("highlight");d3.select(d.foreground).classed("faded",true);e.forEach(S);r.highlight.call(this,e);return this};n.unhighlight=function(e){n.clear("highlight");d3.select(d.foreground).classed("faded",false);return this};n.intersection=function(e,t,n,r){return{x:((e.x*t.y-e.y*t.x)*(n.x-r.x)-(e.x-t.x)*(n.x*r.y-n.y*r.x))/((e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x)),y:((e.x*t.y-e.y*t.x)*(n.y-r.y)-(e.y-t.y)*(n.x*r.y-n.y*r.x))/((e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x))}};n.toString=function(){return"Parallel Coordinates: "+t.dimensions.length+" dimensions ("+d3.keys(t.data[0]).length+" total) , "+t.data.length+" rows"};n.version="0.2.2";return n};d3.renderQueue=function(e){var t=[],n=10,r=function(){},i=0;var s=function(e){if(e)s.data(e);s.invalidate();r();s.render()};s.render=function(){function o(){if(!r)return true;if(i>t.length)return true;var s=t.slice(i,i+n);i+=n;s.map(e)}i=0;var r=true;s.invalidate=function(){r=false};d3.timer(o)};s.data=function(e){s.invalidate();t=e.slice(0);return s};s.rate=function(e){if(!arguments.length)return n;n=e;return s};s.remaining=function(){return t.length-i};s.clear=function(e){if(!arguments.length){r();return s}r=e;return s};s.invalidate=function(){};return s}